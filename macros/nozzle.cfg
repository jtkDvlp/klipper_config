[gcode_macro _CLEAN_NOZZLE]
gcode:
  SAVE_GCODE_STATE NAME=BRUSH_NOZZLE_state
  G0 X50 Y305 F3600
  G0 Z2.5 F3600
  G91
  G0 X50 F10000
  G0 X-50 F10000
  G0 X50 F10000
  G0 X-50 F10000
  G0 Y5 F10000
  G0 X10 Y-10 F10000
  G0 X10 Y10 F10000
  G0 X10 Y-10 F10000
  G0 X15 Y10 F10000
  G0 X-15 Y-10 F10000
  G0 X-10 Y10 F10000
  G0 X-10 Y-10 F10000
  G0 X-10 Y10 F10000
  G0 Y-5 F10000
  G0 X50 F10000
  G0 X-50 F10000
  G0 X50 F10000
  G0 X-50 F10000
  G0 Y5 F10000
  G0 X10 Y-10 F10000
  G0 X10 Y10 F10000
  G0 X10 Y-10 F10000
  G0 X15 Y10 F10000
  G0 X-15 Y-10 F10000
  G0 X-10 Y10 F10000
  G0 X-10 Y-10 F10000
  G0 X-10 Y10 F10000
  G0 Y-5 F10000
  G0 X50 F10000
  G0 X-50 F10000
  G0 X50 F10000
  G0 X-50 F10000
  G0 Y5 F10000
  RESTORE_GCODE_STATE NAME=BRUSH_NOZZLE_state

[gcode_macro _PURGE_NOZZLE]
gcode:
  SAVE_GCODE_STATE NAME=PURGE_NOZZLE_state
  G0 X25 Y310 F3600
  G0 Z10
  G91
  G1 E{params.LEN|default(20)} F300 
  G1 E-5.0 F3600
  RESTORE_GCODE_STATE NAME=PURGE_NOZZLE_state

[gcode_macro PRIME_NOZZLE]
gcode:
  SAVE_GCODE_STATE NAME=PURGE_NOZZLE_state
  G91
  G1 E5.0 F3600
  RESTORE_GCODE_STATE NAME=PURGE_NOZZLE_state

[gcode_macro PURGE_N_CLEAN_NOZZLE]
gcode:
  SAVE_GCODE_STATE NAME=PURGE_N_CLEAN_NOZZLE_state
  LIFT_N_PARK
  _PURGE_NOZZLE
  _CLEAN_NOZZLE
  RESTORE_GCODE_STATE NAME=PURGE_N_CLEAN_NOZZLE_state

[gcode_macro FILAMENT_UNLOAD]
gcode:
  SAVE_GCODE_STATE NAME=FILAMENT_UNLOAD_state
  LIFT_N_PARK
  HEAT_EXTRUDER TEMP={EXTRUDER|default(220)}
  G91
  G1 E-67 F300
  G1 E-30 F300
  HEAT_EXTRUDER TEMP=0
  RESTORE_GCODE_STATE NAME=FILAMENT_UNLOAD_state

[gcode_macro FILAMENT_LOAD]
gcode:
  SAVE_GCODE_STATE NAME=FILAMENT_LOAD_state
  LIFT_N_PARK
  HEAT_EXTRUDER TEMP={EXTRUDER|default(220)}
  G91
  G1 E67 F300
  G90
  _PURGE_NOZZLE LEN=60
  _CLEAN_NOZZLE
  HEAT_EXTRUDER TEMP=0
  RESTORE_GCODE_STATE NAME=FILAMENT_LOAD_state

[gcode_macro _FILAMENT_CHANGE]
gcode:
  PAUSE
  SAVE_GCODE_STATE NAME=FILAMENT_CHANGE
  PARK
  G91
  G1 E-67 F300
  G1 E-30 F300
  G90
  G0 Z{printer["gcode_macro PAUSE"].safe_z}
  G91
  G0 Z2
  G90
  TOOLHEAD
  CHANGE_LED_EFFECT EFFECT=waiting
  RESTORE_GCODE_STATE NAME=FILAMENT_CHANGE
  
[gcode_macro FILAMENT_CHANGE_DONE]
gcode:
  SAVE_GCODE_STATE NAME=FILAMENT_CHANGE_DONE
  LED_OFF
  G90
  G0 Z{printer["gcode_macro PAUSE"].safe_z}
  G91
  G0 Z2
  G90
  PARK
  G91
  G1 E67 F300
  G90
  _PURGE_NOZZLE LEN=60
  _CLEAN_NOZZLE
  RESUME
  RESTORE_GCODE_STATE NAME=FILAMENT_CHANGE_DONE

[gcode_macro T0]
gcode:
  _FILAMENT_CHANGE

[gcode_macro T1]
gcode:
  _FILAMENT_CHANGE

[gcode_macro T2]
gcode:
  _FILAMENT_CHANGE